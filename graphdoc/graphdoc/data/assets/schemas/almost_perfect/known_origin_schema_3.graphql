# noinspection GraphQLMissingType
########################
## Time series events ##
########################

# Generic activity stream events for history of actions including primary and secondary sales actions & triggers
# Used for listing out token history on the token pages
" A table of token events. A token event is an event that occurs when a token is created, transferred, or has a secondary sale. "
type TokenEvent @entity(immutable: true) {
    " The unique identifier for the event "
    id: ID!                     # Composite key made form multiple items
    " The schema version of the event being used. "
    version: BigInt!            # KODA 2 or 3
    " The name of the event. "
    name: String!
    " The token of the event. "
    token: Token!
    " The edition of the event. "
    edition: Edition!
    " The buyer in the event. "
    buyer: Collector
    " The bidder in the event. "
    bidder: Collector
    " The current owner in the event. "
    currentOwner: Collector
    " The value of the event in ETH. "
    ethValue: BigDecimal!

    # Common event details
    " The timestamp of the event. "
    timestamp: BigInt!
    " The transaction hash of the event. "
    transactionHash: Bytes!
    " The transaction index of the event. "
    transactionIndex: BigInt!
    " The log index of the event. "
    logIndex: BigInt!
    " The address of the event. "
    eventAddress: Bytes!
    " The transaction from address of the event. "
    eventTxFrom: Bytes!
    " The transaction to address of the event. "
    eventTxTo: Bytes
    " The block number of the event. "
    blockNumber: BigInt!
}

# Token events for transfers
" A table of transfer events. A transfer event is an event that occurs when a token is transferred. "
type TransferEvent @entity(immutable: true) {
    " The unique identifier for the event. "
    id: ID!
    " The schema version of the event being used. "
    version: BigInt! # KODA 2 or 3
    " The from address of the event. "
    from: Bytes! # address
    " The to address of the event. "
    to: Bytes! # address
    " The token ID of the event. "
    tokenId: BigInt!
    " The edition of the event. "
    edition: Edition!

    # Common event details
    " The timestamp of the event. "
    timestamp: BigInt!
    " The transaction hash of the event. "
    transactionHash: Bytes!
    " The transaction index of the event. "
    transactionIndex: BigInt!
    " The log index of the event. "
    logIndex: BigInt!
    " The address of the event. "
    eventAddress: Bytes!
    " The transaction from address of the event. "
    eventTxFrom: Bytes!
    " The transaction to address of the event. "
    eventTxTo: Bytes
    " The block number of the event. "
    blockNumber: BigInt!
}

# Edition primary sale auction events
" A table of auction events. An auction event is an event that occurs when a token is auctioned. "
type AuctionEvent @entity(immutable: true) {
    " The unique identifier for the event. "
    id: ID!
    " The schema version of the event being used. "
    version: BigInt! # KODA 2 or 3
    " The edition of the event. "
    edition: Edition!
    " The name of the event. "
    name: String!
    " The bidder of the event. "
    bidder: Bytes!
    " The caller of the event. "
    caller: Bytes!
    " The value of the event in ETH. "
    ethValue: BigDecimal!
    " The lockup until of the event. "
    lockupUntil: BigInt # when set the bidder who set this is locked out

    # Common event details
    " The timestamp of the event. "
    timestamp: BigInt!
    " The transaction hash of the event. "
    transactionHash: Bytes!
    " The transaction index of the event. "
    transactionIndex: BigInt!
    " The log index of the event. "
    logIndex: BigInt!
    " The address of the event. "
    eventAddress: Bytes!
    " The transaction from address of the event. "
    eventTxFrom: Bytes!
    " The transaction to address of the event. "
    eventTxTo: Bytes
    " The block number of the event. "
    blockNumber: BigInt!
}

# Common unified event stream spanning KODA versions and various types
" A table of activity events. An activity event is an event that occurs when an activity is performed. "
type ActivityEvent @entity(immutable: true) {
    " The unique identifier for the event. "
    id: ID!
    " The type of the event. "
    type: String!               # Token, Edition or Creator Contract
    " The schema version of the event being used. "
    version: BigInt!            # KODA 2 or 3
    " The type of the event. "
    eventType: String!          # Event types e.g. ['EditionCreated', 'Purchase', 'BidPlaced', 'BidAccepted', 'BidIncreased', 'BidRejected', 'BidWithdrawn']
    " The edition of the event. "
    edition: Edition            # All events relate to an edition unless it's v3
    " The token of the event. "
    token: Token                # (nullable) the token this relates to
    # accounts
    " The creator of the event. "
    creator: Bytes!             # the original edition creator
    " The creator commission of the event. "
    creatorCommission: BigInt  # % received as creator - only valid is event has value
    " The collaborator of the event. "
    collaborator: Bytes        # (nullable) the original edition creator collaborator
    " The collaborator commission of the event. "
    collaboratorCommission: BigInt # (nullable) % received as creator - only valid is event has value
    " The triggered by of the event. "
    triggeredBy: Bytes         # who fired the transaction
    " The buyer of the event. "
    buyer: Bytes                # (nullable) the buyer
    " The seller of the event. "
    seller: Bytes               # (nullable) the seller
    " The stakeholder addresses of the event. "
    stakeholderAddresses: [Bytes!]!     # the addresses that interacted during the event
    " The contract address of the event. "
    contractAddress: Bytes      # the address of the contract

    # technicals
    " The event value in WEI. "
    eventValueInWei: BigInt     # (nullable) the WEI value

    # Common event details
    " The timestamp of the event. "
    timestamp: BigInt!
    " The transaction hash of the event. "
    transactionHash: Bytes!
    " The transaction index of the event. "
    transactionIndex: BigInt!
    " The log index of the event. "
    logIndex: BigInt!
    " The address of the event. "
    eventAddress: Bytes!
    " The transaction from address of the event. "
    eventTxFrom: Bytes!
    " The transaction to address of the event. "
    eventTxTo: Bytes
    " The block number of the event. "
    blockNumber: BigInt!
}

#######################
## Free-text schemas ##
#######################

type _Schema_
@fulltext(
    name: "listedTokenSearch",
    language: en
    algorithm: rank,
    include: [
        {
            entity: "ListedToken",
            fields: [
                { name: "metadataName" },
                { name: "metadataArtist" },
                { name: "metadataArtistAccount" },
                { name: "metadataTagString" },
                { name: "primaryAssetShortType" },
                { name: "primaryAssetActualType" },
            ]
        }
    ]
)
@fulltext(
    name: "editionSearch",
    language: en
    algorithm: rank,
    include: [
        {
            entity: "Edition",
            fields: [
                { name: "metadataName" },
                { name: "metadataArtist" },
                { name: "metadataArtistAccount" },
                { name: "metadataTagString" },
                { name: "metadataFormat" },
                { name: "metadataTheme" },
                { name: "primaryAssetShortType" },
                { name: "primaryAssetActualType" },
            ]
        }
    ]
)

####################################################################################
## Main entities                                                                  ##
## All entities below are NOT event based but are updated from a stream of events ##
####################################################################################

# Rolled up counts for a given day
" A table of day events. A day event is an event that occurs when a day is rolled up. "
type Day @entity {
    " The unique identifier for the event. "
    id: ID!
    " The date of the event. "
    date: String!
    " The transfer count during the day. "
    transferCount: BigInt!
    " The editions count during the day. "
    editionsCount: BigInt!

    # Bid/offer counts and values (primary & secondary)
    " The bids accepted count during the day. "
    bidsAcceptedCount: BigInt! # Offers accepted
    " The bids placed count during the day. "
    bidsPlacedCount: BigInt! # Offers made
    " The bids rejected count during the day. "
    bidsRejectedCount: BigInt! # Offers reject
    " The bids withdrawn count during the day. "
    bidsWithdrawnCount: BigInt!
    " The bids increased count during the day. "
    bidsIncreasedCount: BigInt!
    " The total value placed in bids during the day. "
    totalValuePlaceInBids: BigDecimal!
    " The total value cycled in bids during the day. "
    totalValueCycledInBids: BigDecimal!

    # Secondary sales value in ETH today
    " The secondary sales value in ETH during the day. "
    secondarySalesValue: BigDecimal!

    # Sales/gifting counts and values
    " The issued count during the day. "
    issuedCount: BigInt!
    " The sales count during the day. "
    salesCount: BigInt!
    " The total value in ETH during the day. "
    totalValueInEth: BigDecimal!
    " The highest value in ETH during the day. "
    highestValueInEth: BigDecimal!
    " The highest value token during the day. "
    highestValueToken: Token
    " The issued tokens during the day. "
    issued: [Token!]!
    " The editions during the day. "
    editions: [Edition!]!
}

# N.B: Only for V3 atm
" A table of platform config events. A platform config event is an event that occurs when a platform config is updated. "
type PlatformConfig @entity {
    " The unique identifier for the event. "
    id: ID!

    # NFT
    " The royalties registry address. "
    royaltiesRegistry: Bytes # address
    " The token URI resolver address. "
    tokenUriResolver: Bytes # address

    # Marketplace
    " The modulo of the event. "
    modulo: BigInt
    " The primary sale commission of the event. "
    primarySaleCommission: BigInt
    " The secondary sale royalty of the event. "
    secondarySaleRoyalty: BigInt
    " The marketplace secondary sale royalty of the event. "
    marketplaceSecondarySaleRoyalty: BigInt
    " The minimum bid amount of the event. "
    minBidAmount: BigInt

    # Minting factory
    " The minting period of the event. "
    mintingPeriod: BigInt  # Minting allowance period
    " The maximum mints in period of the event. "
    maxMintsInPeriod: BigInt # Limit of mints with in the period

    # Access controls
    " The merkle proof root of the event. "
    merkleProofRoot: Bytes
    " The merkle proof IPFS hash of the event. "
    merkleProofIpfsHash: String
}

# A token and its details
" A table of tokens. "
type Token @entity {
    " The unique identifier for the token. "
    id: ID!
    " The schema version of the token being used. "
    version: BigInt! # KODA 2, 3 or 4
    " The sales type of the token. "
    salesType: BigInt! # The current sales mechanic being used on this edition
    " The token ID of the token. "
    tokenId: BigInt!
    " The transfer count of the token. "
    transferCount: BigInt!
    " The edition number of the token. "
    editionNumber: String! # Composite ID from edition ID and optional contract address for CC
    " The edition of the token. "
    edition: Edition!
    " The token URI of the token. "
    tokenURI: String!
    " The metadata of the token. "
    metadata: MetaData
    " The birth timestamp of the token. "
    birthTimestamp: BigInt!                 # initial transfer from zero address
    " The primary value in ETH of the token. "
    primaryValueInEth: BigDecimal!          # when it sold from an edition on KO
    " The total purchase value of the token. "
    totalPurchaseValue: BigDecimal!         # tally of all purchases (primary & secondary)
    " The total purchase count of the token. "
    totalPurchaseCount: BigInt!             # tally of the number of purchases (primary & secondary)
    " The largest secondary value in ETH of the token. "
    largestSecondaryValueInEth: BigDecimal! # largest secondary sale in ETH
    " The largest sale price in ETH of the token. "
    largestSalePriceEth: BigDecimal!        # set to the highest sale price for the token, primary or secondary
    " The last sale price in ETH of the token. "
    lastSalePriceInEth: BigDecimal!         # known last sale if we capture it (primary & secondary)
    " The last transfer timestamp of the token. "
    lastTransferTimestamp: BigInt!          # updated on ever Transfer
    " The current owner of the token. "
    currentOwner: Collector                 # the current owner - also has a derived field linking to this from Collector.tokens
    " The all owners of the token. "
    allOwners: [Collector!]!                # list (set) of all unique owners
    " The transfers of the token. "
    transfers: [TransferEvent!]!            # total number of token transfers made
    " The token events of the token. "
    tokenEvents: [TokenEvent!]!             # list of token events such as secondary sales and transfers
    " The open offer of the token. "
    openOffer: TokenOffer,                  # current top active offer on a token
    " The current top bidder of the token. "
    currentTopBidder: Bytes                 # current active top bidder on the secondary market for this token
    " The artist account of the token. "
    artistAccount: Bytes! # address
    " The edition active of the token. "
    editionActive: Boolean!
    " The revoked approval of the token. "
    revokedApproval: Boolean! # set to true once if the seller has revoked approved the marketplace

    ## Token secondary market
    " If a token is listed on the secondary market. "
    isListed: Boolean!
    " The list price of the token. "
    listPrice: BigDecimal
    " The lister of the token. "
    lister: Collector
    " The listing timestamp of the token. "
    listingTimestamp: BigInt

    # Complete attached token
    " The listing of the token. "
    listing: ListedToken
    " The series number of the token. "
    creatorContract: CreatorContract # Optionally capture creator contract address if it is version 4
}

# For Token Secondary market (KODA V2/3 only)
" A table of listed tokens. A listed token is a token that is listed on the secondary market. "
type ListedToken @entity {
    " The unique identifier for the listed token. "
    id: ID!
    " The schema version of the listed token being used. "
    version: BigInt! # KODA 2 or 3
    " The edition number of the listed token. "
    editionNumber: String!
    " If the seller has revoked approved the marketplace. "
    revokedApproval: Boolean! # set to true once if the seller has revoked approved the marketplace
    " The list price of the listed token. "
    listPrice: BigDecimal!
    " The lister of the listed token. "
    lister: Collector!
    " The listing timestamp of the listed token. "
    listingTimestamp: BigInt!
    " The series number of the listed token. "
    seriesNumber: BigInt # i.e. edition no. in the series i.e. #10 from the an edition of 10
    " If the listed token is the first edition. "
    isFirstEdition: Boolean # i.e. token number 1 from edition of 10
    " If the listed token is the last edition. "
    isLastEdition: Boolean # i.e. token number 10 from edition of 10
    " If the listed token is the first artwork from an artist. "
    isGenesisEdition: Boolean # i.e. the first artwork from an artist

    #metadata fields flattened for search
    " The name of the listed token. "
    metadataName: String!
    " The artist of the listed token. "
    metadataArtist: String!
    " The artist account of the listed token. "
    metadataArtistAccount: String!
    " The tag string of the listed token. "
    metadataTagString: String!
    " The primary asset short type of the listed token. "
    primaryAssetShortType: String!
    " The primary asset actual type of the listed token. "
    primaryAssetActualType: String!

    # Complete attached token
    fullToken: Token!

    # ---- Reserve auction fields --------- #
    " The reserve auction seller of the listed token. "
    reserveAuctionSeller: Bytes!     # edition seller
    " The reserve auction bidder of the listed token. "
    reserveAuctionBidder: Bytes!     # current bidder
    " The reserve price of the listed token. "
    reservePrice: BigInt!            # listed reserve price
    " The reserve auction bid of the listed token. "
    reserveAuctionBid: BigInt!       # current bid
    " The reserve auction start date of the listed token. "
    reserveAuctionStartDate: BigInt! # auction start
    " The previous reserve auction end timestamp of the listed token. "
    previousReserveAuctionEndTimestamp: BigInt! # set to the same as reserve unless an extension is in flight
    " The reserve auction end timestamp of the listed token. "
    reserveAuctionEndTimestamp: BigInt!         # when the auction will end
    " The reserve auction number of times extended of the listed token. "
    reserveAuctionNumTimesExtended: BigInt!     # number of times auction has been extended
    " If the reserve auction is in sudden death. "
    isReserveAuctionInSuddenDeath: Boolean!     # set to true when in sudden death
    " The reserve auction total extension length in seconds of the listed token. "
    reserveAuctionTotalExtensionLengthInSeconds: BigInt! # total extension

    " If the reserve auction has resulted. "
    isReserveAuctionResulted: Boolean!
    " The reserve auction resulted date time of the listed token. "
    isReserveAuctionResultedDateTime: BigInt!
    " The reserve auction resulter of the listed token. "
    reserveAuctionResulter: Bytes!
    " If the reserve auction can emergency exit. "
    reserveAuctionCanEmergencyExit: Boolean!
    # ----- End of reserve auction fields - #

    " The creator contract of the listed token. "
    creatorContract: CreatorContract # Optionally capture creator contract address if this is version 4
}

# A composable is a combination of a V3 NFT and a set number of tokens
" A table of composables. A composable is a combination of a V3 NFT and a set number of tokens. "
type Composable @entity {
    " The unique identifier for the composable. "
    id: ID! # toString for address
    " The items of the composable. "
    items: [ComposableItem!]  # An array of composable items
}

# ComposableItem represents one token attached to a composable
" A table of composable items. A composable item is a token that is attached to a composable. "
type ComposableItem @entity  {
    " The unique identifier for the composable item. The ID is made up of combined tokenID/composing contract/composing IDs "
    id: ID! # ID made up of combined tokenID/composing contract/composing IDs
    " The address of the ERC20/ERC721 token. "
    address: String! # Address of the ERC20/ERC721 token
    " The token ID of the composable item. "
    tokenID: String! # ID of the token
    " The type of the composable item (ERC20, ERC721, etc). "
    type: String! # Type of token, ERC20, ERC721 etc
    " The Number of tokens attached or the ERC721 token ID. "
    value: BigInt! # Number of tokens attached or the ERC721 token ID
}

# Maintain an list of approved collective handlers i.e. contracts which are cloned and used
" A table of collective handlers. A collective handler is a contract that is cloned and used. "
type CollectiveHandlers @entity {
    " The unique identifier for the collective handler. "
    id: ID! # base address
    " If the collective handler is active. "
    active: Boolean!
    " The last updated timestamp of the collective handler. "
    lastUpdatedTimestamp: BigInt!
    " The last updated transaction hash of the collective handler. "
    lastUpdatedTransactionHash: Bytes!
}

" A table of collectives. A collective is a set of tokens that are owned by a single entity. "
type Collective @entity {
    " The unique identifier for the collective (deployed address). "
    id: ID! # deployed address
    " The base handler of the collective (clone address). "
    baseHandler: Bytes! # clone which this is based on
    " The creator address of the collective (who deployed it). "
    creator: Bytes! # who deployed it
    " The recipients of the collective. "
    recipients: [Bytes!]! # recipients for the deployed collab
    " The splits of the collective. "
    splits: [BigInt!]! # splits for the deployed collab
    " The created timestamp of the collective. "
    createdTimestamp: BigInt!
    " The transaction hash of the collective. "
    transactionHash: Bytes!
    " The editions assigned to the collective. "
    editions: [Edition!]! # A list of editions assigned to
    " If the collective is deployed. "
    isDeployed: Boolean!
}

# A token/editions and its meta data
" A table of editions (tokens) and its meta data. "
type Edition @entity {
    " The unique identifier for the edition (Composite ID from edition ID and optional contract address for CC). "
    id: ID! # Composite ID from edition ID and optional contract address for CC
    " The schema version of the edition being used (KODA 2, 3 or 4). "
    version: BigInt! # KODA 2 or 3 or 4
    " The edition number of the edition (edition no. not composite key). "
    editionNmber: String! # edition no. not composite key
    " The edition type of the edition (legacy field from KODA V2). "
    editionType: BigInt! # legacy field from KODA V2
    " The edition data of the edition (legacy field from KODA V2). "
    editionData: Bytes # bytes32 - legacy field from KODA V2 - some additional data about the edition
    " The creator contract of the edition (address of creator contract that minted the edition if version 4). "
    creatorContract: CreatorContract # address of creator contract that minted the edition if version 4
    " The sales type of the edition (The current sales mechanic being used on this edition). "
    salesType: BigInt! # The current sales mechanic being used on this edition
    " If the seller has revoked approved the marketplace. "
    revokedApproval: Boolean! # set to true once if the seller has revoked approved the marketplace
    " The created timestamp of the edition. "
    createdTimestamp: BigInt!
    " The token IDs of the edition. "
    tokenIds: [String!]!
    " The tokens of the edition. "
    tokens: [Token!]! @derivedFrom(field: "edition")
    " The token URI of the edition. "
    tokenURI: String!
    " The artist account of the edition. "
    artistAccount: Bytes! # address
    " The artist commission of the edition. "
    artistCommission: BigInt! # base artists commission
    " The optional commission account of the edition. "
    optionalCommissionAccount: Bytes # address - NOTE: deprecated - V2 only - use collaborators for
    " The optional commission rate of the edition. "
    optionalCommissionRate: BigInt
    " The collaborators of the edition. "
    collaborators: [Bytes!]! # list of addresses who have collaborated on this edition
    " The collective of the edition. "
    collective: Collective # nullable V3 collective i.e. its split funds
    " If the edition is offers only. "
    offersOnly: Boolean!

    # Token counters
    " The total supply of the edition (Total purchases or mints i.e. total number of primary transfers). "
    totalSupply: BigInt!         # Total purchases or mints i.e. total number of primary transfers
    " The total available of the edition (Total number available to be purchased i.e. edition size). "
    totalAvailable: BigInt!      # Total number available to be purchased i.e. edition size
    " The remaining supply of the edition (Total remaining i.e. number of primary sale tokens left to buy from this edition). "
    remainingSupply: BigInt!     # Total remaining i.e. number of primary sale tokens left to buy from this edition
    " The total sold of the edition (sold = purchase/bid accepted with price > 0). "
    totalSold: BigInt!           # sold = purchase/bid accepted with price > 0
    " The total burnt of the edition (number of items send to 0xDead or 0x0 (only applicable for V3)). "
    totalBurnt: BigInt!          # number of items send to 0xDead or 0x0 (only applicable for V3)
    " The original edition size of the edition at mint - this field should NEVER change once set. "
    originalEditionSize: BigInt! # original edition size of the edition at mint - this field should NEVER change once set
    " The secondary royalty percentage requested by the creator(s) at the edition level. "
    secondaryRoyaltyV4EditionOverride: BigInt # At the edition level, the EIP2981 percentage requested by the creator(s)
    " The sales of the edition. "
    sales: [Token!]!
    " The total eth spent on the edition. "
    totalEthSpentOnEdition: BigDecimal!,
    " If the edition is active. "
    active: Boolean!
    " The metadata of the edition. "
    metadata: MetaData  
    " If the edition is the first edition of the artist. "
    isGenesisEdition: Boolean! # set true if edition is an artists first edition
    " If the edition is enhanced (i.e. composed). "
    isEnhancedEdition: Boolean! # set true if any of the tokens are enhanced i.e. composed
    " If the edition is open (i.e. the artist does not mint all of the tokens up front). "
    isOpenEdition: Boolean # applicable to version 4 and editions where the artist does not mint all of the tokens up front
    " If the edition has a cover image. "
    hasCoverImage: Boolean! # set to true if non-image asset with cover image

    # Reference to the primary minter
    " The artist of the edition. "
    artist: Artist

    # date when the edition goes on sale
    " The start date of the edition. "
    startDate: BigInt!
    " The end date of the edition. "
    endDate: BigInt!   # date when the edition is available until (only applicable for V2)

    # ---- Reserve auction fields --------- #
    " The reserve auction seller of the edition. "
    reserveAuctionSeller: Bytes!     # edition seller
    " The reserve auction bidder of the edition. "
    reserveAuctionBidder: Bytes!     # current bidder
    " The reserve price of the edition. "
    reservePrice: BigInt!            # listed reserve price
    " The reserve auction bid of the edition. "
    reserveAuctionBid: BigInt!       # current bid
    " The reserve auction start date of the edition. "
    reserveAuctionStartDate: BigInt! # auction start
    " The previous reserve auction end timestamp of the edition. "
    previousReserveAuctionEndTimestamp: BigInt! # set to the same as reserve unless an extension is in flight
    " The reserve auction end timestamp of the edition. "
    reserveAuctionEndTimestamp: BigInt!         # when the auction will end
    " The reserve auction number of times extended of the edition. "
    reserveAuctionNumTimesExtended: BigInt!     # number of times auction has been extended
    " If the reserve auction is in sudden death. "
    isReserveAuctionInSuddenDeath: Boolean!     # set to true when in sudden death
    " The reserve auction total extension length in seconds of the edition. "
    reserveAuctionTotalExtensionLengthInSeconds: BigInt! # total extension

    " If the reserve auction has resulted. "
    isReserveAuctionResulted: Boolean!
    " The reserve auction resulted date time of the edition. "
    isReserveAuctionResultedDateTime: BigInt!
    " The reserve auction resulter of the edition. "
    reserveAuctionResulter: Bytes!
    " If the reserve auction can emergency exit. "
    reserveAuctionCanEmergencyExit: Boolean!
    # ----- End of reserve auction fields - #

    # ----- Buy now price / current step price - #
    " The price of the edition in wei (buy now price / current step price). "
    priceInWei: BigInt!
    # ----- Buy now price / current step price - #

    # ----- step sale - #
    " The base price of the edition for the step sale. "
    stepSaleBasePrice: BigInt!
    " The step price of the edition for the step sale. "
    stepSaleStepPrice: BigInt!
    " The current step of the edition for the step sale. "
    currentStep: BigInt!
    # ----- step sale - #

    # ----- Offers logic - #
    " If the auction is enabled. "
    auctionEnabled: Boolean!
    " The active bid of the edition. "
    activeBid: AuctionEvent # if present, an active bid should be open
    # ----- Offers logic - #

    # ----- Gated sale config - #
    " The gated sale of the edition. "
    gatedSale: GatedSale        # the linked gated sale
    # ----- Gated sale config - #

    # Events and histories
    " The bidding history of the edition. "
    biddingHistory: [AuctionEvent!]!
    " The transfers of the edition. "
    transfers: [TransferEvent!]! # total number of token transfers made for all tokens from the edition
    " The all owners of the edition. "
    allOwners: [Collector!]! # list (set) of all unique owners for all tokens
    " The current owners of the edition. "
    currentOwners: [Collector!]! # Current set of owners for this edition
    " The primary owners of the edition. "
    primaryOwners: [Collector!]! # Owners (set) when sold in primary sale

    # START: freetext search fields
    " The name of the edition. "
    metadataName: String!
    " The artist of the edition. "
    metadataArtist: String!
    " The tag string of the edition. "
    metadataTagString: String!
    " The artist account of the edition. "
    metadataArtistAccount: String!
    " The price of the edition (consolidated price for all sale types, making it orderable in lists). "
    metadataPrice: BigInt! # A consolidated price for all sale types, making it orderable in lists
    " The format of the edition. "
    metadataFormat: String # null-able as V3 only
    " The theme of the edition. "
    metadataTheme: String # null-able as V3 only
    " The primary asset short type of the edition (null-able leading mime-type field i.e. image or video etc). "
    primaryAssetShortType: String # null-able leading mime-type field i.e. image or video etc
    " The primary asset actual type of the edition (null-able ending mime-type field e.g. mp4, gif, png etc). "
    primaryAssetActualType: String # null-able ending mime-type field e.g. mp4, gif, png etc
    # END: freetext search fields
}

# A token/editions and its meta data
" A table of meta data for tokens/editions. "
type MetaData @entity(immutable: true) {
    " The unique identifier for the meta data. "
    id: ID!
    " The name of the meta data. "
    name: String
    " The description of the meta data. "
    description: String
    " The image of the meta data. "
    image: String
    # only added july-2020
    " The image type of the meta data. "
    image_type: String
    " The image size in bytes of the meta data. "
    image_size_in_bytes: BigInt

    # optional - only added july-2020
    " The cover image of the meta data. "
    cover_image: String
    " The cover image type of the meta data. "
    cover_image_type: String
    " The cover image size in bytes of the meta data. "
    cover_image_size_in_bytes: BigInt
    " The animation URL of the meta data. "
    animation_url: String

    # optional - only added Jan-21
    " If the image is a sphere (optional). "
    image_sphere: Boolean
    " The scarcity of object. "
    scarcity: String
    " The artist of the object. "
    artist: String
    " The tags of the object. "
    tags: [String!]

    # New tags added in V3
    " The production year of the object. "
    production_year: String
    " The format of the object. "
    format: String
    " The theme of the object. "
    theme: String
    " If the object is NSFW. "
    nsfw: Boolean
}

# Single high level entity capturing the top offer on the secondary marketplace
" A table of token offers. "
type TokenOffer @entity(immutable: true) {
    " The unique identifier for the token offer. "
    id: ID!
    " The version of the token offer (KODA 2 or 3). "
    version: BigInt! # KODA 2 or 3
    " The token of the token offer. "
    token: Token!
    " The edition of the token offer. "
    edition: Edition!
    " The owner at the time of the bid. "
    ownerAtTimeOfBid: Collector!
    " The bidder of the token offer. "
    bidder: Collector!
    " The eth value of the token offer. "
    ethValue: BigDecimal!
    " The wei value of the token offer. "
    weiValue: BigInt!
    " The timestamp of the token offer. "
    timestamp: BigInt!
}

# Encapsulates all offers either on editions or tokens
" A table of offers either on editions or tokens. "
type Offer @entity {
    " The unique identifier for the offer. "
    id: ID!                         # edition ID or token ID
    " The version of the offer (KODA 2 or 3). "
    version: BigInt!                # KODA 2 or 3
    " The type of the offer (Token or Edition). "
    type: String!                   # either Token or Edition
    " The sales type of the offer (The current sales mechnic being used on this offer). "
    salesType: BigInt!              # The current sales mechnic being used on this offer
    " The token of the offer (nullable token, as editions dont have tokens attached). "
    token: Token                    # nullable token, as editions dont have tokens attached
    " The edition of the offer (All offers must be from an edition). "
    edition: Edition!               # All offers must be from an edition
    " The current owner of the offer (This is either the token holder or the edition artist). "
    currentOwner: Collector!        # This is either the token holder or the edition artist
    " The bidder of the offer. "
    bidder: Collector!              # Who is making the bid
    " The eth value of the offer. "
    ethValue: BigDecimal!
    " The wei value of the offer. "
    weiValue: BigInt!
    " The timestamp of the offer. "
    timestamp: BigInt!
    " The transaction hash of the offer. "
    transactionHash: Bytes!
    " The locked until timestamp of the offer (for V3 offers, they will be locked for a certain amount of time). "
    lockedUntil: BigInt             # For V3 offers, they will be locked for a certain amount of time
    " If the offer is active. "
    isActive: Boolean!              # Only active offers can be seen in the UI
}

# Store the total mints per user, per sale & phase
" A table of the total mints per user, per sale & phase. "
type PhaseMintCount @entity {
    " The unique identifier for the phase mint count (composite key (sale, edition, phase, minter) - unique per user and sale/phase). "
    id: ID!                  # composite key (sale, edition, phase, minter) - unique per user and sale/phase
    " The sale this phase relates to. "
    saleId: String!          # The sale this phase relates to
    " The edition this phase relates to. "
    editionId: String!       # The edition this phase relates to
    " The actual phase number. "
    phaseId: String!         # The actual phase number
    " The minter. "
    minter: String!          # The minter
    " The count of mints. "
    count: BigInt!           # How many have they minted
}

# A gate sale phase configuration
" Table of gate sale phase configurations. "
type Phase @entity {
    " The unique identifier for the phase. "
    id: ID!
    " The sale this phase relates to. "
    saleId: String!          # The sale this phase relates to
    " The edition this phase relates to. "
    editionId: String!       # The edition this phase relates to
    " The actual phase number. "
    phaseId: String!         # The actual phase number
    " The start time of the sale as a whole. "
    startTime: BigInt!       # The start time of the sale as a whole
    " The end time of the sale phase, also the beginning of the next phase if applicable. "
    endTime: BigInt!         # The end time of the sale phase, also the beginning of the next phase if applicable
    " The mint limit per wallet for the phase. "
    walletMintLimit: BigInt! # The mint limit per wallet for the phase
    " The price in wei for one mint. "
    priceInWei: BigInt!      # Price in wei for one mint
    " The maximum amount of mints for the phase. "
    mintCap: BigInt!         # The maximum amount of mints for the phase
    " The current amount of items minted in this phase. "
    mintCount: BigInt!       # The current amount of items minted in this phase
    " The merkle tree root for the phase. "
    merkleRoot: Bytes        # The merkle tree root for the phase
    " The IPFS hash referencing the merkle tree. "
    merkleIPFSHash: String   # The IPFS hash referencing the merkle tree
}

# A gate sale configuration - one per edition
" A table of gate sale configurations per edition. "
type GatedSale @entity {
    " The unique identifier for the gated sale. "
    id: ID!                 # The ID of the sale
    " The ID of the edition the sale will mint. "
    editionId: String!      # The ID of the edition the sale will mint
    " Whether the sale is currently paused. "
    paused: Boolean!        # Whether the sale is currently paused
    " The sales commission for KO. "
    primarySaleCommission: BigInt! # overridden sales commission for KO
    " The address of the artist associated with the given edition ID. "
    artistAccount: String   # The address of the artist associated with the given edition ID
    " The total mint current for the sale. "
    mintCount: BigInt!      # The total mint current for the sale
    " The associated sales. "
    phases: [Phase!]!       # associated sales
}

# Any KODA V4 Contract Deployed from the V4 factory
" A table of KODA V4 contracts deployed from the V4 factory. "
type CreatorContract @entity {
    " The unique identifier for the creator contract. "
    id: ID!

    # Deployment information
    " The block number of the deployment. "
    blockNumber: BigInt!
    " The timestamp of the deployment. "
    timestamp: BigInt!
    " The transaction hash of the deployment. "
    transactionHash: Bytes!
    " The transaction index of the deployment. "
    transactionIndex: BigInt!
    " The log index of the deployment. "
    logIndex: BigInt!
    " The address of the event. "
    eventAddress: Bytes!
    " The transaction from address of the event. "
    eventTxFrom: Bytes!
    " The transaction to address of the event. "
    eventTxTo: Bytes
    " The address of the implementation contract. "
    implementation: Bytes!          # address of the contract cloned during the deployment of the creator contract
    " The deployer address of the creator contract. "
    deployer: Bytes!                # deployer may be different to creator in the case that platform deployed a contract
    " The creator address of the creator contract. "
    creator: Bytes!

    # Current Settings
    " Whether the creator contract is paused. "
    paused: Boolean!
    " The owner of the creator contract. "
    owner: Bytes!
    " The secondary royalty percentage for the creator contract (Across all editions the currently specified secondary royalty EIP2981). "
    secondaryRoyaltyPercentage: BigInt! # Across all editions the currently specified secondary royalty EIP2981
    " The minter of the creator contract. "
    minter: Bytes!

    # Funds handler
    " The default funds handler for the creator contract. "
    defaultFundsHandler: Bytes!
    " The default funds recipients for the creator contract. "
    defaultFundsRecipients: [Bytes!]!
    " The default funds shares for the creator contract. "
    defaultFundsShares: [BigInt!]!

    # Interface ID
    " The ERC165 interface ID for the creator contract. "
    ERC165InterfaceID: Bytes # TODO - Assembly script casting issues fetching this from contract
    " If the creator contract is batch buy it now. "
    isBatchBuyItNow: Boolean!
    # banned - flagged by the creator contract factory
    " If the creator contract is hidden. "
    isHidden: Boolean!

    #Transfer details - see transferStates.ts
    " The transfer state of the creator contract. "
    transferState: BigInt!

    # Global stats
    " The total number of editions created by the creator contract. "
    totalNumOfEditions: BigInt!
    " The total number of tokens sold by the creator contract. "
    totalNumOfTokensSold: BigInt!
    " The total ETH value of sales by the creator contract. "
    totalEthValueOfSales: BigDecimal!
    " The total number of transfers by the creator contract. "
    totalNumOfTransfers: BigInt!

    # Editions created by contract
    " The editions created by the creator contract. "
    editions: [Edition!]!

    # Contract metadata
    " The name of the creator contract. "
    name: String
    " The symbol of the creator contract. "
    symbol: String
    " The filter registry of the creator contract. "
    filterRegistry: Bytes
}

# A table of creator contract settings
" A table of creator contract settings. "
type CreatorContractSetting @entity {
    " The unique identifier for the creator contract setting. "
    id: ID!
    " The factory contract of the creator contract. "
    factoryContract: Bytes!             # Creator contract factory
    " The KODA sales settings contract of the creator contract. "
    kodaSalesSettingsContract: Bytes!   # Things like current primary sales settings
    " The platform of the creator contract. "
    platform: Bytes!                    # Address

    # Settings direct from KODA Settings contract
    " The platform primary commission. "
    platformPrimaryCommission: BigInt!
    " The platform secondary commission. "
    platformSecondaryCommission: BigInt!
    " The modulo for the platform. "
    MODULO: BigInt!
}

##########################
## Accountable entities ##
##########################

# A table of artist minting configurations
" A table of artist minting configurations. "
type ArtistMintingConfig @entity {
    " The unique identifier for the artist minting configuration. "
    id: ID!
    " The total number of mints. "
    mints: BigInt!
    " The first mint in the period. "
    firstMintInPeriod: BigInt!
    " Whether the user can mint as much as possible. "
    frequencyOverride: Boolean! # set to true if the user can mint as much as possible
}

# An artists who has created editions/tokens
" A table of artists who has created editions/tokens. "
type Artist @entity {
    " The unique identifier for the artist. "
    id: ID!
    " The address of the artist. "
    address: Bytes! # address
    " The name of the artist. "
    name: String
    " The number of editions created by the artist. "
    editionsCount: BigInt!
    " The number of editions created by the artist. "
    ccEditionsCount: BigInt!
    " The total supply of the artist. "
    supply: BigInt!
    " The total number of tokens issued by the artist. "
    issuedCount: BigInt!
    " The total value of sales by the artist in ETH. "
    totalValueInEth: BigDecimal!
    " The total number of sales by the artist. "
    salesCount: BigInt!

    " The total number of primary sales by the artist. "
    totalPrimarySales: BigInt!
    " The total value of primary sales by the artist in ETH. "
    totalPrimarySalesInEth: BigDecimal!
    " The total number of secondary sales by the artist. "
    totalSecondarySales: BigInt!
    " The total value of secondary sales by the artist in ETH. "
    totalSecondarySalesInEth: BigDecimal!

    " The highest sale value by the artist in ETH. "
    highestSaleValueInEth: BigDecimal!
    " The highest sale token by the artist. "
    highestSaleToken: Token

    " The first edition created by the artist. "
    firstEdition: Edition
    " The timestamp of the first edition created by the artist. "
    firstEditionTimestamp: BigInt!
    " The last edition created by the artist. "
    lastEdition: Edition
    " The timestamp of the last edition created by the artist. "
    lastEditionTimestamp: BigInt!

    # all artist editions - derivedFrom only work at query time, not runtime!
    " The editions created by the artist. "
    editions: [Edition!]! @derivedFrom(field: "artist")
    " The IDs of the editions created by the artist. "
    editionIds: [Edition!]!
    " The minting configuration for the artist. "
    mintingConfig: ArtistMintingConfig!
    " The creator contracts associated with the artist. "
    creatorContracts: [CreatorContract!]

}

# A single collector who has at sometime held a KO asset
" A table of collectors who have at sometime held a KO asset. "
type Collector @entity {
    " The unique identifier for the collector. "
    id: ID! # toString for address
    " The address of the collector. "
    address: Bytes! # address
    " The first time the collector was seen. "
    firstSeen: BigInt!
    " The timestamp of the first purchase. "
    firstPurchaseTimeStamp: BigInt!
    " The timestamp of the last purchase. "
    lastPurchaseTimeStamp: BigInt!

    # Primary sales counts
    " The number of primary sales by the collector. "
    primaryPurchaseCount: BigInt!
    " The total value of primary sales by the collector in ETH. "
    primaryPurchaseEthSpent: BigDecimal!

    # Secondary sales counts
    " The number of secondary sales by the collector. "
    secondarySaleCount: BigInt!
    " The total value of secondary sales by the collector in ETH. "
    secondarySaleEthTotal: BigDecimal!
    " The number of secondary purchases by the collector. "
    secondaryPurchaseCount: BigInt!
    " The total value of secondary purchases by the collector in ETH. "
    secondaryPurchaseEthSpent: BigDecimal!

    # Primary & secondary sales counts
    " The total number of purchases by the collector. "
    totalPurchaseCount: BigInt!
    " The total value of purchases by the collector in ETH. "
    totalPurchaseEthSpent: BigDecimal!

    # all tokens currently owned by this account - derivedFrom only work at query time, not runtime!
    " The tokens currently owned by the collector. "
    tokens: [Token!]! @derivedFrom(field: "currentOwner")
    " The IDs of the tokens currently owned by the collector. "
    tokenIds: [Token!]!
}
